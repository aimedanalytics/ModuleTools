% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/heatmap_annotation.R
\name{heatmap_annotation}
\alias{heatmap_annotation}
\title{Build heatmap annotations for ECharts JSON}
\usage{
heatmap_annotation(meta_data, sample_column, col.annotation)
}
\arguments{
\item{meta_data}{data.frame or tibble with sample-level metadata. Must contain
the sample identifier column given by `sample_column`, and all columns listed
in `col.annotation`.}

\item{sample_column}{character(1). Name of the column in `meta_data` that
contains sample IDs. Ordering of rows in the output follows the order of
`meta_data[[sample_column]]`.}

\item{col.annotation}{character vector. Names of columns in `meta_data` to
encode as annotations.}
}
\value{
A list of annotation blocks. Each block is a list with elements:
  - name (character)
  - field (character)
  - legend (list of lists with elements `code` (integer) and `label` (character))
  - rows (list of lists; each has `sample` and the code field)
}
\description{
Constructs annotation metadata for heatmap visualizations based on sample-level
metadata columns. For each requested annotation field, this function:
  - Converts values to character labels, replacing NA with "(missing)"
  - Computes a stable code per unique label (1..K in label appearance order)
  - Produces a legend mapping codes to labels
  - Produces a row-wise mapping aligned to the provided sample column
}
\details{
The returned structure matches the schema expected by the heatmap JSON:
a list of annotation blocks, each with:
  - name: the original column name
  - field: the generated code field name (e.g., "<col>Code")
  - legend: list of {code, label}
  - rows: list of per-sample entries with {sample, <field>=code}


Label coding preserves the first-seen order of unique labels in the column.
Missing values are represented by the label "(missing)" and receive a code
like any other label.
}
\examples{
meta <- data.frame(
  sample_id = c("S1","S2","S3","S4"),
  group = c("A","A","B","B"),
  batch = c("X","Y",NA,"Y"),
  stringsAsFactors = FALSE
)
ann <- heatmap_annotation(
  meta_data = meta,
  sample_column = "sample_id",
  col.annotation = c("group","batch")
)
str(ann, max.level = 2)

}
